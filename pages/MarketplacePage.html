<style>
    /* Marketplace Page Specific Styles */
    .hero-banner {
        /* Set background image for the hero banner, using the provided image */
        background-image: url('uploaded:image_5319d0.jpg-3a21ed48-784c-4c2a-a9d4-6b1691cb0a17');
        background-size: cover;
        background-position: center;
        /* Adjusted height to be consistent with previous requests (250px) */
        height: 250px;
        position: relative; /* Ensure relative positioning for overlay */
        display: flex; /* Use flexbox for content alignment */
        flex-direction: column; /* Stack children vertically */
        justify-content: center; /* Center content vertically */
        align-items: center; /* Center content horizontally */
        padding: 6rem 4rem; /* Adjusted padding for content positioning */
        /* Removed max-width and margin from here to allow it to expand to edges */
    }
    .hero-banner::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.3); /* Dark overlay for text readability */
        z-index: 0;
    }
    .hero-banner .z-10 {
        z-index: 1; /* Ensure text and search bar are above the overlay */
        /* Keep max-width for content readability, and ensure it's centered */
        max-width: 40rem; /* Constrain width for better readability, similar to home page's max-w-2xl */
        width: 100%; /* Ensure it takes full width within its max-width */
        text-align: center; /* Center text within the z-10 div */
    }
    .product-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 0.75rem;
        background-color: white;
        border-radius: 0.75rem; /* rounded-xl */
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
        border: 1px solid #e2e8f0; /* border-gray-200 */
        cursor: pointer; /* Make product cards clickable */
        transition: transform 0.2s ease-in-out; /* Smooth hover effect */
    }
    .product-card:hover {
        transform: translateY(-5px); /* Lift card on hover */
    }
    .product-card img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 0.5rem; /* rounded-lg */
        margin-bottom: 0.5rem;
    }

    /* Modal Styles (specific to marketplace as it triggers here) */
    /* NOTE: These styles are here for reference, the actual modal HTML is in index.html */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000; /* Higher z-index to ensure it's on top */
    }
    .modal-content {
        background-color: #fff;
        padding: 2rem;
        border-radius: 1rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        max-width: 90%;
        width: 400px;
        text-align: center;
        position: relative;
    }
    .modal-close-btn {
        position: absolute;
        top: 1rem;
        right: 1rem;
        font-size: 1.5rem;
        cursor: pointer;
        color: #888;
    }
    .hidden {
        display: none;
    }
</style>
<section id="marketplace-page-section" class="page-section">
    <!-- Hero Banner Section -->
    <header class="hero-banner flex flex-col justify-center items-center text-white p-6 rounded-b-3xl mb-8">
        <div class="z-10 w-full max-w-md"> <!-- Content remains centered with a max-width -->
            <h1 class="text-3xl md:text-4xl font-bold mb-4 text-center">Welcome to the Marketplace!</h1>
            <div class="w-full max-w-md bg-white rounded-full p-2 flex items-center shadow-lg mx-auto"> <!-- Search bar is explicitly centered -->
                <i class="fas fa-search text-gray-500 ml-3"></i>
                <input type="text" placeholder="Search for products..." class="flex-1 px-4 py-2 rounded-full text-gray-800 focus:outline-none">
            </div>
        </div>
    </header>

    <div class="w-full max-w-7xl mx-auto">
        <!-- Main Content Area -->
        <main class="p-4 space-y-8">
            <!-- Produce Market Section -->
            <section class="bg-white rounded-2xl shadow-lg p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-semibold text-gray-800 flex items-center space-x-2">
                        <i class="fas fa-shopping-basket text-green-600"></i>
                        <span>PRODUCE MARKET</span>
                    </h2>
                    <h3 class="text-xl font-medium text-gray-700">TOP SELLERS</h3>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <!-- Product Card: Lettuce -->
                    <div class="product-card" data-product-name="LETTUCE" data-product-price="60.00" data-product-unit="1KG / HEAD" data-product-location="Metro Manila" data-product-image="https://placehold.co/80x80/E0F2F7/000?text=LETTUCE">
                        <img src="https://placehold.co/80x80/E0F2F7/000?text=LETTUCE" alt="Lettuce">
                        <span class="text-sm font-medium text-gray-800 text-center">LETTUCE</span>
                    </div>
                    <!-- Product Card: Carrots -->
                    <div class="product-card" data-product-name="CARROTS" data-product-price="80.00" data-product-unit="PER KILO" data-product-location="Metro Manila" data-product-image="https://placehold.co/80x80/FFDDC1/000?text=CARROTS">
                        <img src="https://placehold.co/80x80/FFDDC1/000?text=CARROTS" alt="Carrots">
                        <span class="text-sm font-medium text-gray-800 text-center">CARROTS</span>
                    </div>
                    <!-- Product Card: Tomatoes -->
                    <div class="product-card" data-product-name="TOMATOES" data-product-price="180.00" data-product-unit="PER KILO" data-product-location="Metro Manila" data-product-image="https://placehold.co/80x80/FCE7D7/000?text=TOMATOES">
                        <img src="https://placehold.co/80x80/FCE7D7/000?text=TOMATOES" alt="Tomatoes">
                        <span class="text-sm font-medium text-gray-800 text-center">TOMATOES</span>
                    </div>
                    <!-- Product Card: Rice -->
                    <div class="product-card" data-product-name="RICE" data-product-price="50.00" data-product-unit="PER KILO" data-product-location="Laguna" data-product-image="https://placehold.co/80x80/F0F8FF/000?text=RICE">
                        <img src="https://placehold.co/80x80/F0F8FF/000?text=RICE" alt="Rice">
                        <span class="text-sm font-medium text-gray-800 text-center">RICE</span>
                    </div>
                </div>
            </section>

            <!-- Market Catalog Section -->
            <section class="bg-white rounded-2xl shadow-lg p-6">
                <h2 class="text-2xl font-semibold text-gray-800 flex items-center space-x-2 mb-6">
                    <i class="fas fa-tags text-green-600"></i>
                    <span>MARKET CATALOG</span>
                </h2>

                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <!-- Catalog Item: Fruits & Vegetables -->
                    <div class="flex flex-col items-center p-3 bg-gray-100 rounded-xl shadow-sm cursor-pointer hover:shadow-md transition-all">
                        <img src="https://placehold.co/120x80/D1E7DD/000?text=Fruits+&+Veggies" alt="Fruits & Vegetables" class="w-full h-24 object-cover rounded-lg mb-2">
                        <span class="text-base font-medium text-gray-800">Fruits & Vegetables</span>
                    </div>
                    <!-- Catalog Item: Crops -->
                    <div class="flex flex-col items-center p-3 bg-gray-100 rounded-xl shadow-sm cursor-pointer hover:shadow-md transition-all">
                        <img src="https://placehold.co/120x80/F5E6CC/000?text=Crops" alt="Crops" class="w-full h-24 object-cover rounded-lg mb-2">
                        <span class="text-base font-medium text-gray-800">Crops</span>
                    </div>
                    <!-- Catalog Item: Supplies -->
                    <div class="flex flex-col items-center p-3 bg-gray-100 rounded-xl shadow-sm cursor-pointer hover:shadow-md transition-all">
                        <img src="https://placehold.co/120x80/D0F0C0/000?text=Supplies" alt="Supplies" class="w-full h-24 object-cover rounded-lg mb-2">
                        <span class="text-base font-medium text-gray-800">Supplies</span>
                    </div>
                </div>
            </section>

            <!-- Fruits & Vegetables Section -->
            <section class="bg-white rounded-2xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-gray-800 flex items-center space-x-2">
                        <i class="fas fa-apple-alt text-green-600"></i>
                        <span>Fruits & Vegetables</span>
                    </h2>
                    <button class="bg-green-100 text-green-700 px-4 py-2 rounded-full text-sm font-medium hover:bg-green-200 transition-colors">
                        SEE MORE <i class="fas fa-chevron-right ml-1 text-xs"></i>
                    </button>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <!-- Product Card: Lettuce -->
                    <div class="product-card" data-product-name="LETTUCE" data-product-price="60.00" data-product-unit="1KG / HEAD" data-product-location="Metro Manila" data-product-image="https://placehold.co/80x80/E0F2F7/000?text=LETTUCE">
                        <img src="https://placehold.co/80x80/E0F2F7/000?text=LETTUCE" alt="Lettuce">
                        <span class="text-sm font-medium text-gray-800 text-center">LETTUCE</span>
                    </div>
                    <!-- Product Card: Carrots -->
                    <div class="product-card" data-product-name="CARROTS" data-product-price="80.00" data-product-unit="PER KILO" data-product-location="Metro Manila" data-product-image="https://placehold.co/80x80/FFDDC1/000?text=CARROTS">
                        <img src="https://placehold.co/80x80/FFDDC1/000?text=CARROTS" alt="Carrots">
                        <span class="text-sm font-medium text-gray-800 text-center">CARROTS</span>
                    </div>
                    <!-- Product Card: Tomatoes -->
                    <div class="product-card" data-product-name="TOMATOES" data-product-price="180.00" data-product-unit="PER KILO" data-product-location="Metro Manila" data-product-image="https://placehold.co/80x80/FCE7D7/000?text=TOMATOES">
                        <img src="https://placehold.co/80x80/FCE7D7/000?text=TOMATOES" alt="Tomatoes">
                        <span class="text-sm font-medium text-gray-800 text-center">TOMATOES</span>
                    </div>
                    <!-- Product Card: Grapes (Placeholder) -->
                    <div class="product-card" data-product-name="GRAPES" data-product-price="250.00" data-product-unit="PER BUNCH" data-product-location="Batangas" data-product-image="https://placehold.co/80x80/C0E0B0/000?text=GRAPES">
                        <img src="https://placehold.co/80x80/C0E0B0/000?text=GRAPES" alt="Grapes">
                        <span class="text-sm font-medium text-gray-800 text-center">GRAPES</span>
                    </div>
                </div>
            </section>

            <!-- Crops Section -->
            <section class="bg-white rounded-2xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-gray-800 flex items-center space-x-2">
                        <i class="fas fa-seedling text-green-600"></i>
                        <span>Crops</span>
                    </h2>
                    <button class="bg-green-100 text-green-700 px-4 py-2 rounded-full text-sm font-medium hover:bg-green-200 transition-colors">
                        SEE MORE <i class="fas fa-chevron-right ml-1 text-xs"></i>
                    </button>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <!-- Product Card: Rice -->
                    <div class="product-card" data-product-name="RICE" data-product-price="50.00" data-product-unit="PER KILO" data-product-location="Laguna" data-product-image="https://placehold.co/80x80/F0F8FF/000?text=RICE">
                        <img src="https://placehold.co/80x80/F0F8FF/000?text=RICE" alt="Rice">
                        <span class="text-sm font-medium text-gray-800 text-center">RICE</span>
                    </div>
                    <!-- Product Card: Wheat -->
                    <div class="product-card" data-product-name="WHEAT" data-product-price="45.00" data-product-unit="PER KILO" data-product-location="Bulacan" data-product-image="https://placehold.co/80x80/F0F8FF/000?text=WHEAT">
                        <img src="https://placehold.co/80x80/F0F8FF/000?text=WHEAT" alt="Wheat">
                        <span class="text-sm font-medium text-gray-800 text-center">WHEAT</span>
                    </div>
                    <!-- Product Card: Corn -->
                    <div class="product-card" data-product-name="CORN" data-product-price="30.00" data-product-unit="PER COB" data-product-location="Pangasinan" data-product-image="https://placehold.co/80x80/FFED8C/000?text=CORN">
                        <img src="https://placehold.co/80x80/FFED8C/000?text=CORN" alt="Corn">
                        <span class="text-sm font-medium text-gray-800 text-center">CORN</span>
                    </div>
                    <!-- Product Card: Beans (Placeholder) -->
                    <div class="product-card" data-product-name="BEANS" data-product-price="120.00" data-product-unit="PER KILO" data-product-location="Nueva Ecija" data-product-image="https://placehold.co/80x80/E0F0E0/000?text=BEANS">
                        <img src="https://placehold.co/80x80/E0F0E0/000?text=BEANS" alt="Beans">
                        <span class="text-sm font-medium text-gray-800 text-center">BEANS</span>
                    </div>
                </div>
            </section>

            <!-- Supplies Section -->
            <section class="bg-white rounded-2xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-gray-800 flex items-center space-x-2">
                        <i class="fas fa-toolbox text-green-600"></i>
                        <span>Supplies</span>
                    </h2>
                    <button class="bg-green-100 text-green-700 px-4 py-2 rounded-full text-sm font-medium hover:bg-green-200 transition-colors">
                        SEE MORE <i class="fas fa-chevron-right ml-1 text-xs"></i>
                    </button>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <!-- Product Card: Fertilizer -->
                    <div class="product-card" data-product-name="FERTILIZER" data-product-price="300.00" data-product-unit="PER BAG" data-product-location="Cavite" data-product-image="https://placehold.co/80x80/D0F0C0/000?text=FERTILIZER">
                        <img src="https://placehold.co/80x80/D0F0C0/000?text=FERTILIZER" alt="Fertilizer">
                        <span class="text-sm font-medium text-gray-800 text-center">FERTILIZER</span>
                    </div>
                    <!-- Product Card: Pesticide -->
                    <div class="product-card" data-product-name="PESTICIDE" data-product-price="150.00" data-product-unit="PER LITER" data-product-location="Laguna" data-product-image="https://placehold.co/80x80/D0F0C0/000?text=PESTICIDE">
                        <img src="https://placehold.co/80x80/D0F0C0/000?text=PESTICIDE" alt="Pesticide">
                        <span class="text-sm font-medium text-gray-800 text-center">PESTICIDE</span>
                    </div>
                    <!-- Product Card: Seed Tray -->
                    <div class="product-card" data-product-name="SEED TRAY" data-product-price="50.00" data-product-unit="PER PIECE" data-product-location="Batangas" data-product-image="https://placehold.co/80x80/F0F0F0/000?text=SEED+TRAY">
                        <img src="https://placehold.co/80x80/F0F0F0/000?text=SEED+TRAY" alt="Seed Tray">
                        <span class="text-sm font-medium text-gray-800 text-center">SEED TRAY</span>
                    </div>
                    <!-- Product Card: Garden Gloves (Placeholder) -->
                    <div class="product-card" data-product-name="GARDEN GLOVES" data-product-price="100.00" data-product-unit="PER PAIR" data-product-location="Quezon" data-product-image="https://placehold.co/80x80/D0F0C0/000?text=GLOVES">
                        <img src="https://placehold.co/80x80/D0F0C0/000?text=GLOVES" alt="Garden Gloves">
                        <span class="text-sm font-medium text-gray-800 text-center">GARDEN GLOVES</span>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- This script attaches event listeners for product cards -->
    <script>
        // Ensure this script runs only after the DOM for marketplace is loaded
        // It's exposed globally by the main script.js after injection
        function attachMarketplaceProductListeners() {
            console.log("[marketplace.html] attachMarketplaceProductListeners called. Attaching product card listeners.");
            const productCards = document.querySelectorAll('.product-card');
            productCards.forEach(card => {
                // Clone the node to remove any previously attached event listeners
                const newCard = card.cloneNode(true);
                card.parentNode.replaceChild(newCard, card);

                newCard.addEventListener('click', () => {
                    // Access window.currentUserRole directly, assuming script.js exposes it globally
                    if (window.currentUserRole === 'guest') {
                        // If the user is a guest, show the login/signup modal
                        if (window.showAuthModal) {
                            window.showAuthModal();
                            console.log("[marketplace.html] Guest user clicked product. Showing login modal.");
                        } else {
                            console.error("[marketplace.html] window.showAuthModal is not defined.");
                        }
                    } else {
                        // If user is logged in, prepare product details and start checkout modal
                        console.log('[marketplace.html] Logged-in user clicked product. Starting checkout modal.');
                        const productDetails = {
                            name: newCard.dataset.productName,
                            price: parseFloat(newCard.dataset.productPrice),
                            unit: newCard.dataset.productUnit,
                            location: newCard.dataset.productLocation,
                            image: newCard.dataset.productImage,
                            quantity: 1 // Default quantity when adding from marketplace
                        };
                        // Call the global function in script.js to open the checkout modal
                        if (window.startCheckout) {
                            window.startCheckout(productDetails);
                        } else {
                            console.error("[marketplace.html] window.startCheckout is not defined. Ensure script.js is loaded correctly.");
                        }
                    }
                });
            });
        }
        // Expose this function globally so script.js can call it after loading this fragment
        window.attachMarketplaceProductListeners = attachMarketplaceProductListeners;

        // Immediately call if this script happens to be loaded directly (e.g., for testing in isolation)
        // For dynamic loading by script.js, the call will be explicit from script.js.
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            // This checks if the DOM is already ready, which is typical for dynamically injected content
            attachMarketplaceProductListeners();
        } else {
            // Fallback for slower loading or if script is in head (less common for fragments)
            document.addEventListener('DOMContentLoaded', attachMarketplaceProductListeners);
        }


    </script>
</section>
